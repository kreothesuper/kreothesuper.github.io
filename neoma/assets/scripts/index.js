
const stepObject = [
    {
        id: 1,
        priceArray: [
            {
                id: 1,
                phaseArray: [
                    ['-', '-', '10%', '4%', '7%', '-', '-', '$105,00'],
                    ['No time limit', '5', '$1.000,00', '$400,00', '$700,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$400,00', '$700,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 2,
                phaseArray: [
                    ['-', '-', '10%', '4%', '7%', '-', '-', '$245,00'],
                    ['No time limit', '5', '$2.500,00', '$1.000,00', '$1.750,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$1.000,00', '$1.750,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 3,
                phaseArray: [
                    ['-', '-', '10%', '4%', '7%', '-', '-', '$395,00'],
                    ['No time limit', '5', '$5.000,00', '$2.000,00', '$3.500,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$2.000,00', '$3.500,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 4,
                phaseArray: [
                    ['-', '-', '10%', '4%', '7%', '-', '-', '$595,00'],
                    ['No time limit', '5', '$10.000,00', '$4.000,00', '$7.000,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$4.000,00', '$7.000,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 5,
                phaseArray: [
                    ['-', '-', '10%', '4%', '7%', '-', '-', '$1.295,00'],
                    ['No time limit', '5', '$25.000,00', '$10.000,00', '$17.500,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$10.000,00', '$17.500,00', '80/20', 'Trailing', 'Refundable']
                ]
            },

        ],
    },
    {
        id: 2,
        priceArray: [
            {
                id: 1,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$155,00'],
                    ['No time limit', '1', '$1.000,00', '$400,00', '$800,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$400,00', '$800,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 2,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$295,00'],
                    ['No time limit', '1', '$2.500,00', '$1.000,00', '$2.000,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$1.000,00', '$2.000,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 3,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$495,00'],
                    ['No time limit', '1', '$5.000,00', '$2.000,00', '$4.000,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$2.000,00', '$4.000,00', '80/20', 'Trailing', 'Refundable']
                ]
            },

            {
                id: 4,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$695,00'],
                    ['No time limit', '1', '$10.000,00', '$4.000,00', '$8.000,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$4.000,00', '$8.000,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 5,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$1.395,00'],
                    ['No time limit', '1', '$25.000,00', '$10.000,00', '$20.000,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$10.000,00', '$20.000,00', '80/20', 'Trailing', 'Refundable']
                ]
            },

        ],
    },
    {
        id: 3,
        priceArray: [
            {
                id: 1,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$155,00'],
                    ['No time limit', '1', '$1.000,00', '$400,00', '$800,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$400,00', '$800,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 2,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$295,00'],
                    ['No time limit', '1', '$2.500,00', '$1.000,00', '$2.000,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$1.000,00', '$2.000,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 3,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$495,00'],
                    ['No time limit', '1', '$5.000,00', '$2.000,00', '$4.000,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$2.000,00', '$4.000,00', '80/20', 'Trailing', 'Refundable']
                ]
            },

            {
                id: 4,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$695,00'],
                    ['No time limit', '1', '$10.000,00', '$4.000,00', '$8.000,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$4.000,00', '$8.000,00', '80/20', 'Trailing', 'Refundable']
                ]
            },
            {
                id: 5,
                phaseArray: [
                    ['-', '-', '10%', '4%', '8%', '-', '-', '$1.395,00'],
                    ['No time limit', '1', '$25.000,00', '$10.000,00', '$20.000,00', '-', 'Trailing', 'Free'],
                    ['No time limit', '-', '-', '$10.000,00', '$20.000,00', '80/20', 'Trailing', 'Refundable']
                ]
            },

        ],
    }
];


const findObjectById = (id, object) => {
    return object.find(obj => obj.id == id);
}


const initTabs = () => {
    const tabs = [...document.querySelectorAll(".tabs")];

    if (tabs.length > 0) {
        tabs.forEach((tab) => {
            const tabContent = [...tab.querySelectorAll(".tabs__content")];
            const tabLinks = [...tab.querySelectorAll(".tabs__link")];

            const openTab = (tabIndex = 0) => {
                tabContent.forEach((element, i) => {
                    const isActive = i === tabIndex;
                    element.classList.toggle("active", isActive);
                });

                tabLinks.forEach((element, i) => {
                    element.classList.toggle("active", i === tabIndex);
                });
            }

            openTab(0)

            tabLinks.forEach((link, i) => {
                link.addEventListener("click", (e) => {
                    e.preventDefault();
                    openTab(i);
                });
            });
        });
    }
}



const selectInit = () => {
    const selectArray = document.querySelectorAll('.custom-select');

    if (selectArray.length > 0) {
        selectArray.forEach((element, index) => {
            const selectTag = element.querySelector('select'),
                selectOption = selectTag.querySelectorAll('option');

            const selectWrapper = document.createElement('div'),
                selectLabel = document.createElement('div'),
                selectItemList = document.createElement('div'),
                selectLabelSpan = document.createElement('span'),
                selectLabelIcon = document.createElement('span');

            const selectItemArray = [];

            selectWrapper.classList.add('select__wrapper');

            selectLabel.classList.add('select__label');
            selectLabelIcon.classList.add('icon');
            selectLabelSpan.classList.add('select__name');

            selectLabelSpan.textContent = selectTag[selectTag.selectedIndex].textContent;
            selectLabel.append(selectLabelSpan);
            selectLabel.append(selectLabelIcon)

            if (selectTag[selectTag.selectedIndex].hidden) {
                selectLabel.classList.add('select__label--disabled')
            } else {
                selectLabel.classList.remove('select__label--disabled')
            }

            selectItemList.classList.add('select__content', 'select__content--hidden')

            selectWrapper.append(selectLabel);
            element.append(selectWrapper);

            selectOption.forEach((element, index) => {
                const selectItem = document.createElement('div');
                const selectSpan = document.createElement('span');

                selectItem.classList.add('select__item');
                selectSpan.textContent = element.textContent;

                selectItem.append(selectSpan);

                if (element.hidden) {
                    selectItem.classList.add('select__item--disabled');
                }

                // Check if the delegated event is triggered properly
                selectItem.addEventListener('click', (e) => {
                    const selectItemTag = e.target.closest('.select').querySelector('select'),
                        selectItemOptions = selectItemTag.querySelectorAll('option'),
                        selectItems = e.target.closest('.select').querySelectorAll('.select__item');


                    selectItemOptions.forEach((element, index) => {
                        if (element.textContent === selectItem.textContent) {
                            selectItemTag.selectedIndex = index;
                            selectLabelSpan.textContent = element.textContent;


                            selectItems.forEach((item, itemIndex) => {
                                if (itemIndex === index) {
                                    item.classList.add('select__item--hidden')
                                } else {
                                    item.classList.remove('select__item--hidden');
                                }
                            });

                            // Trigger change event when selectIndex is changed
                            const event = new Event('change', { bubbles: true });
                            selectItemTag.dispatchEvent(event);
                        }
                    });
                    selectLabel.click();
                });

                selectItemArray.push(selectItem);
                const selectItems = selectItemList.querySelectorAll('.select__item');
                selectItems.forEach((item, itemIndex) => {
                    if (itemIndex === selectTag.selectedIndex) {
                        item.classList.add('select__item--hidden');
                    } else {
                        item.classList.remove('select__item--hidden');
                    }
                });
                selectItemList.append(selectItem);
            });

            selectWrapper.append(selectItemList);

            // Check if the click event is properly handled
            selectLabel.addEventListener('click', (e) => {
                e.stopPropagation();

                closeAllSelect(selectLabel);
                window.innerHeight - selectItemList.getBoundingClientRect().bottom < 100 ? (selectItemList.classList.add('select__content--top'), selectLabel.classList.add('select__label--top')) : (selectItemList.classList.remove('select__content--top'), selectLabel.classList.remove('select__label--top'))

                selectItemList.classList.toggle('select__content--hidden');
                selectLabel.classList.toggle('select__label--active');
                element.classList.toggle('select--active');
            });

            selectTag.addEventListener('change', () => {
                const selectItemOptions = selectTag.options,
                    selectedItem = selectItemOptions[selectTag.selectedIndex];

                selectLabelSpan.textContent = selectedItem.textContent;
                if (selectedItem.hidden) {
                    selectLabel.classList.add('select__label--disabled')
                } else {
                    selectLabel.classList.remove('select__label--disabled')

                }
            })
            selectTag.addEventListener('reset', () => {
                const selectItemOptions = selectTag.options,
                    selectedItem = selectItemOptions[0];

                selectLabelSpan.textContent = selectedItem.textContent;
                if (selectedItem.hidden) {
                    selectLabel.classList.add('select__label--disabled')
                } else {
                    selectLabel.classList.remove('select__label--disabled')

                }
            })
        });

        document.addEventListener('click', closeAllSelect);
    }
}

const closeAllSelect = (select) => {
    const selectContentArray = document.querySelectorAll('.select__content'),
        selectLabelArray = document.querySelectorAll('.select__label');

    selectLabelArray.forEach((element, index) => {
        element !== select ? (element.classList.remove('select--active'), selectContentArray[index].classList.add('select__content--hidden')) : null;
    });
}

document.addEventListener('DOMContentLoaded', () => {
    const burger = document.querySelector('.burger'),
        header = document.querySelector('.header'),
        headerNav = document.querySelector('.header-nav');

    if (burger && header) {

        const observer = new IntersectionObserver(
            ([e]) => e.target.classList.toggle("is-pinned", e.intersectionRatio < 1),
            { threshold: [1] }
        );

        observer.observe(headerNav);

        burger.addEventListener('click', (e) => {
            e.preventDefault();

            header.classList.toggle('header--active');
            headerNav.classList.toggle('header-nav--active');
            burger.classList.toggle('burger--active');
        });
    }

    selectInit();

    const reviewSlider = document.querySelector('.review-slider');

    if (reviewSlider) {
        const review = new Swiper(reviewSlider, {
            slidesPerView: 1,
            spaceBetween: 20,
            speed: 500,
            breakpoints: {
                768: {
                    slidesPerView: 3,
                }
            },
            navigation: {
                nextEl: '.review-slider__button--next',
                prevEl: '.review-slider__button--prev',
            },
        });
    }


    const configureList = document.querySelector('.js-configure');

    if (configureList) {
        const drawNewPhase = (balanceId, phaseId) => {
            const phase = findObjectById(phaseId, stepObject),
                balance = findObjectById(balanceId, phase.priceArray),
                itemsArray = balance.phaseArray;

            configureListArray.forEach((element, index) => {
                const configureItemArray = element.querySelectorAll('.js-configure-list-item');

                configureItemArray.forEach((item, itemIndex) => {
                    item.querySelector('.js-configure-text').textContent = itemsArray[index][itemIndex];
                });
            });
        }

        const configureListArray = configureList.querySelectorAll('.js-configure-list');
        const balanceChecked = configureList.querySelector("[name='balance']:checked").value;
        const phaseChecked = configureList.querySelector("[name='phase']:checked").value;

        drawNewPhase(balanceChecked, phaseChecked);

        configureList.addEventListener('change', () => {
            const balanceChecked = configureList.querySelector("[name='balance']:checked").value;
            const phaseChecked = configureList.querySelector("[name='phase']:checked").value;

            drawNewPhase(balanceChecked, phaseChecked);
        });
    }

    initTabs();


    const videoArray = document.querySelectorAll('.video');

    if (videoArray.length) {
        videoArray.forEach(video => {
            const videoElement = document.querySelector('video');
         
            video.addEventListener('click', function () {
                if (videoElement.paused) {
                    videoElement.play();
                    video.classList.add('play');
                } else {
                    videoElement.pause();
                    video.classList.remove('play');
                }
            });
        })
    }
});
